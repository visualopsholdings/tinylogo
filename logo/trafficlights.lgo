#   trafficlights.lgo
#
#   Author: Paul Hamilton (paul@visualops.com)
#   Date: 2-Jun-2023
#
#   Allow a button to change traffic lights. The second button turns
#   the entire thing on and off and changes a second LED to light red
#   when it's off and light green when it's on.
#
#   This work is licensed under the Creative Commons Attribution 4.0 International License. 
#   To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/ or 
#   send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.
#
#   https://github.com/visualopsholdings/tinylogo  
#

# change your pins here
TO B1PIN
  2
END

TO R1PIN
  3
END

TO G1PIN
  4
END

TO BTN2PIN
  6
END

TO BTN1PIN
  7
END

TO B2PIN
  9
END

TO R2PIN
  10
END

TO G2PIN
  11
END

# setup all the pins for in out and values
TO SETUP
  PINOUT R1PIN
  AOUT R1PIN 255
  PINOUT G1PIN
  AOUT G1PIN 255
  PINOUT B1PIN
  AOUT B1PIN 255
  
  PINOUT R2PIN
  AOUT R2PIN 255
  PINOUT G2PIN
  AOUT G2PIN 255
  PINOUT B2PIN
  AOUT B2PIN 255

  PININ BTN1PIN
  PININ BTN2PIN
END

# send raw values out to each pin
TO RED1R :V
  AOUT R1PIN :V
END

TO GREEN1R :V
  AOUT G1PIN :V
END

TO BLUE1R :V
  AOUT B1PIN :V
END

TO RED2R :V
  AOUT R2PIN :V
END

TO GREEN2R :V
  AOUT G2PIN :V
END

TO BLUE2R :V
  AOUT B2PIN :V
END

TO BUTTON1
  DREAD BTN1PIN
END

TO BUTTON2
  DREAD BTN2PIN
END

# scale a color to be between 1 and 100
TO SCLR :C
  # ((100 - :C) / 100) * 255
  255 * 1 / 100 / 100 - :C
END

# arguments are reversed!
TO SET1 :B :G :R
  RED1R SCLR :R
  GREEN1R SCLR :G
  BLUE1R SCLR :B
END

# arguments are reversed!
TO SET2 :B :G :R
  RED2R SCLR :R
  GREEN2R SCLR :G
  BLUE2R SCLR :B
END

# the named colors we use for each LED

TO AMBER1
 SET1 100 75 0
END

TO RED1
  SET1 100 0 0
END

TO GREEN1
  SET1 0 100 0
END

TO RED2
  SET2 8 2 2
END

TO GREEN2
  SET2 2 8 2
END

TO OFF1
  SET1 0 0 0
END

# the button logic

# STATE1 holds 0 for RED, 1 for GREEN and 2 for AMBER for the first LED
# STATE2 holds 0 for OFF and 1 for ON

TO NEXTSTATE1
  :STATE1 + 1
END

TO FIRSTSTATE1
  MAKE "STATE1 0
END

TO NOTRED1
  IFELSE :STATE1 = 1 GREEN1 AMBER1
END

TO PRESS1
  MAKE "STATE1 NEXTSTATE1
  IF :STATE1 > 2 FIRSTSTATE1
  IFELSE :STATE1 = 0 RED1 NOTRED1
END

TO TESTST1
  MAKE "OLDVALUE1 :VALUE1
  IF :VALUE1 = 1 PRESS1
END

TO TESTB1
  MAKE "VALUE1 BUTTON1
  IF :VALUE1 != :OLDVALUE1 TESTST1
END

TO OFF
  OFF1
  RED2
END

TO ON
  RED1
  GREEN2
END

TO NOTSTATE2
  NOT :STATE2
END

TO PRESS2
  MAKE "STATE2 NOTSTATE2
  IFELSE :STATE2 = 0 OFF ON
END

TO TESTST2
  MAKE "OLDVALUE2 :VALUE2
  IF :VALUE2 = 1 PRESS2
END

TO TESTB2
  MAKE "VALUE2 BUTTON2
  IF :VALUE2 != :OLDVALUE2 TESTST2
END

TO TESTB
  IF :STATE2 = 1 TESTB1
  TESTB2
END

TO START
  MAKE "STATE2 1
  GREEN2
  RED1
  FOREVER TESTB
END

START


 
